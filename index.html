
<!DOCTYPE html>
<html>
<head>
      <script src='wax/ext/modestmaps.min.js' type='text/javascript'></script>
    <script src='wax/dist/wax.mm.js' type='text/javascript'></script>
    <link href='wax/theme/controls.css' rel='stylesheet' type='text/css' />
  <script src='http://api.tiles.mapbox.com/mapbox.js/v0.6.7/mapbox.js'></script>
  <link href='http://api.tiles.mapbox.com/mapbox.js/v0.6.7/mapbox.css' rel='stylesheet' />
  <style>
    body { margin:0; padding:0; }
</style>
</head>
<body>
<style>
   /*SIDEBAR - where the list of markers will be  */
#sidebar {
  position:absolute;
  top:0px;
  left:0px;
  background:#fff;
  z-index:999;
  overflow:auto;
  opacity:0.6;
  }
#sidebar:hover { opacity:1; }
#timeline {
  padding:10px;
  right:15px;
  }
#timeline a {
  font-size:10px;
  text-decoration:none;
  }
#timeline #controls {
  position:absolute;
  top:15px;
  }
#timeline #controls a {
  font-size:20px;
  color:#DC1438;
  margin-left:10px;
  }
a.year-active {
  color:#DC1438;
  }
  </style>

<div id='sidebar'>
  <div id='timeline'>
    <h2>Cleveland Photography Society's 2012 Photo Scavenger Hunt <small>Presented by: Sponsors</small></h2>
  </div>
</div>

<div id='modestmaps-setup'></div>
<script>
// example from http://mapbox.com/wax/#making-your-first-map 
  var url = 'http://a.tiles.mapbox.com/v3/skorasaurus.cpsscav2012.jsonp';
wax.tilejson(url, function(tilejson) {
    // Set up a map in a div with the id 'modestmaps-setup'
    var m = new MM.Map('modestmaps-setup',
      // Use Wax's connector to add a new custom layer
      new wax.mm.connector(tilejson),
      // And i
      new MM.Point(800,800));
    m.setCenterZoom({ lat: 41.5010, lon: -81.6922}, 15);
    // sets the allowable zoom range, this ignores what is available in your tilemill project
    m.setZoomRange(15, 19);
});



  var timeline = document.getElementById('timeline'),
      controls = document.getElementById('controls');

  var markerLayer = mapbox.markers.layer()
      // this is a quick optimization - otherwise all markers are briefly displayed
      // before filtering to 2001
      .filter(function() { return false })
      .url('../layers/locations.geojson', function(err, features) {

      // A closure for clicking years. You give it a year, and it returns a function
      // that, when run, clicks that year. It's this way in o


 // A closure for clicking years. You give it a year, and it returns a function
      // that, when run, clicks that year. It's this way in order to be used as both an
      // event handler and run manually.
      function click_year(y) {
          return function() {
              var active = document.getElementsByClassName('year-active');
              if (active.length) active[0].className = '';
              document.getElementById('y' + y).className = 'year-active';
              markerLayer.filter(function(f) {
                  return f.properties.year == y;
              });
              return false;
          };
      }

// Vars
// WAS years - 
// WAS yearlist - 
// WAS year_links - tre_links

      var years = {},
          yearlist = [],
          tre_links = [];

      for (var i = 0; i < features.length; i++) {
          years[features[i].properties.tre] = true;
      }

      for (var y in years) yearlist.push(y);
      yearlist.sort();

      for (var i = 0; i < yearlist.length; i++) {
          var a = timeline.appendChild(document.createElement('a'));
          a.innerHTML = yearlist[i] + ' ';
          a.id = 'y' + yearlist[i];
          a.href = '#';
          a.onclick = click_year(yearlist[i]);
      }

        });

  map.addLayer(markerLayer);
</script>
   
</body>
</html>